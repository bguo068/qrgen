<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>QR Code Generator</title>
    <style>
      /* Define the style for the image */
      .resized-image {
        height: 33vh; /* Set height to 1/3 of the viewport height */
        width: auto; /* Keep the width auto to maintain aspect ratio */
      }
    </style>
    <script type="module">
      import init, { generate_image_from_url } from "./pkg/qrgen.js";

      // Initialize WASM module once the page loads
      async function initializeWasm() {
        try {
          await init(); // Initialize wasm-bindgen
          console.log("WASM initialized successfully");
        } catch (err) {
          console.error("Initialization error:", err);
        }
      }

      initializeWasm();

      // Function to display error messages on the webpage
      function displayError(message) {
        const errorContainer = document.getElementById("error-container");
        errorContainer.textContent = message; // Set the error message
      }

      // Function to generate image from URL
      async function generateImage() {
        const urlInput = document.getElementById("url-input").value; // Get the URL from the input box
        const imageContainer = document.getElementById("image-container"); // Get the image container

        if (!urlInput) {
          displayError("URL is empty.");
          return;
        }

        try {
          // Call the Rust function with the provided URL and handle the result synchronously
          const result = generate_image_from_url(urlInput);

          if (result instanceof Uint8Array) {
            // clear error
            displayError("");
            // Clear the image container before appending a new image
            imageContainer.innerHTML = "";

            const img = new Image();
            img.src = URL.createObjectURL(
              new Blob([result], { type: "image/png" })
            );
            img.classList.add("resized-image");
            imageContainer.appendChild(img); // Append the new image to the container
          } else {
            displayError("Error generating image:", result);
          }
        } catch (err) {
          displayError("Error generating image:", err);
        }
      }

      // Add event listener after DOM is fully loaded
      window.addEventListener("DOMContentLoaded", (event) => {
        const generateButton = document.getElementById("generate-button");
        generateButton.addEventListener("click", generateImage);
      });
    </script>
  </head>
  <body>
    <h1>QR Code Generator</h1>
    <br />
    Enter your target URL in the input box and click "Generate." A QR code image
    will be produced. Right-click on the image to save it to your computer.
    <!-- Input box for the URL -->
    <br />
    <input
      type="text"
      id="url-input"
      placeholder="Enter target URL"
      style="width: 300px"
    /><br />
    <!-- Button to generate the image -->
    <button id="generate-button">Generate</button>

    <!-- Container for error messages -->
    <div id="error-container" class="error-message"></div>

    <!-- Container for the generated image -->
    <div id="image-container"></div>
  </body>
</html>
